const packages = require('../packages');
const fs = require('fs');
const render = require('json-templater/string');
const upperCamelcase = require('uppercamelcase');
const path = require('path');
const endOfLine = require('os').EOL;

const OUTPUT_PATH = path.join(__dirname, '../element-ui.js');
const IMPORT_TEMPLATE = `import 'element-ui/lib/theme-chalk/{{package}}.css';
import {{name}} from 'element-ui/lib/{{package}}';`;
const USE_TEMPLATE = `    .use({{name}})`
const MAIN_TEMPLATE = `/* Automatically generated by './src/components/element-ui/bin/generate-entry.js' */
import Vue from 'vue';
{{imports}}

Vue
{{uses}};
`;
const packagesTemplate = [];
const usesTemplate = [];
packages.forEach(name => {
    const componentName = upperCamelcase(name);
    packagesTemplate.push(render(IMPORT_TEMPLATE, {
        name: componentName,
        package: name
    }));

    usesTemplate.push(render(USE_TEMPLATE, {
        name: componentName,
    }));
});

const template = render(MAIN_TEMPLATE, {
    imports: packagesTemplate.join(endOfLine),
    uses: usesTemplate.join(endOfLine),
});

fs.writeFileSync(OUTPUT_PATH, template);
console.log('[generated entry] DONE:', OUTPUT_PATH);
